# .semaphore/production-deploy.yml
version: v1.0
name: Deploy to Equinox
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Release dinoSQL for Linux
    task:
      jobs:
        - name: Build and release
          commands:
            - checkout
            - sem-version go 1.12
            - curl -O https://bin.equinox.io/c/mBWdkfai63v/release-tool-stable-linux-amd64.tgz
            - tar -xvf release-tool-stable-linux-amd64.tgz 
            - ./equinox release --config ./.equinox.yml --draft --version $SEMAPHORE_GIT_SHA --token $EQUINOX_API_TOKEN ./cmd/dinosql
      secrets:
        - name: equinox
  - name: Release dinoSQL for macOS
    task:
      agent:
        machine:
          type: a1-standard-4
          os_image: macos-mojave
      jobs:
        - name: Build and release
          commands:
            - checkout
            - brew install go@1.12
            - brew install eqnxio/equinox/release-tool
            - equinox release --config ./.equinox.yml --draft --version $SEMAPHORE_GIT_SHA --token $EQUINOX_API_TOKEN ./cmd/dinosql
            - equinox publish --token xxx --app app_xxx --channel stable --version 0.1
      secrets:
        - name: equinox

